var model_json, scene, scene2, renderer, main, toggle_panel_btn, nav_panel, camera, controls, groups, visibility, group, insetwidth, insetheight, size, travel, floor_btn, room1, room2, pathPoints, pathPointsFloors, findPathButton, pause_text;

const extrudeSettings = {
    steps: 2,
    depth: 30,
    bevelEnabled: false
};

var path = [[-1160, 436, 1], [-1162, 436, 1], [-1164, 436, 1], [-1166, 436, 1], [-1168, 436, 1], [-1170, 436, 1], [-1172, 436, 1], [-1174, 436, 1], [-1176, 436, 1], [-1178, 436, 1], [-1180, 436, 1], [-1182, 436, 1], [-1184, 436, 1], [-1186, 436, 1], [-1188, 436, 1], [-1190, 436, 1], [-1192, 436, 1], [-1194, 436, 1], [-1196, 436, 1], [-1198, 436, 1], [-1200, 436, 1], [-1202, 436, 1], [-1202, 438, 1], [-1202, 440, 1], [-1202, 442, 1], [-1202, 444, 1], [-1202, 446, 1], [-1202, 448, 1], [-1202, 450, 1], [-1202, 452, 1], [-1202, 454, 1], [-1202, 456, 1], [-1202, 458, 1], [-1202, 460, 1], [-1202, 462, 1], [-1202, 464, 1], [-1202, 466, 1], [-1202, 468, 1], [-1202, 470, 1], [-1202, 472, 1], [-1202, 474, 1], [-1202, 476, 1], [-1202, 478, 1], [-1202, 480, 1], [-1202, 482, 1], [-1202, 484, 1], [-1202, 486, 1], [-1202, 488, 1], [-1202, 490, 1], [-1202, 492, 1], [-1202, 494, 1], [-1202, 496, 1], [-1202, 498, 1], [-1202, 500, 1], [-1202, 502, 1], [-1202, 504, 1], [-1200, 504, 1], [-1198, 504, 1], [-1196, 504, 1], [-1194, 504, 1], [-1192, 504, 1], [-1190, 504, 1], [-1188, 504, 1], [-1186, 504, 1], [-1184, 504, 1], [-1182, 504, 1], [-1180, 504, 1], [-1178, 504, 1], [-1176, 504, 1], [-1174, 504, 1], [-1172, 504, 1], [-1170, 504, 1], [-1168, 504, 1], [-1166, 504, 1], [-1164, 504, 1], [-1162, 504, 1], [-1160, 504, 1], [-1158, 504, 1], [-1156, 504, 1], [-1154, 504, 1], [-1152, 504, 1], [-1150, 504, 1], [-1148, 504, 1], [-1146, 504, 1], [-1144, 504, 1], [-1142, 504, 1], [-1140, 504, 1], [-1138, 504, 1], [-1136, 504, 1], [-1134, 504, 1], [-1132, 504, 1], [-1130, 504, 1], [-1128, 504, 1], [-1126, 504, 1], [-1124, 504, 1], [-1122, 504, 1], [-1120, 504, 1], [-1118, 504, 1], [-1116, 504, 1], [-1114, 504, 1], [-1112, 504, 1], [-1110, 504, 1], [-1108, 504, 1], [-1106, 504, 1], [-1104, 504, 1], [-1102, 504, 1], [-1102, 502, 1], [-1102, 500, 1], [-1102, 498, 1], [-1102, 496, 1], [-1102, 494, 1], [-1102, 492, 1], [-1102, 490, 1], [-1102, 488, 1], [-1100, 488, 1], [-1098, 488, 1], [-1096, 488, 1], [-1094, 488, 1], [-1092, 488, 1], [-1090, 488, 1], [-1088, 488, 1], [-1086, 488, 1], [-1084, 488, 1], [-1082, 488, 1], [-1080, 488, 1], [-1078, 488, 1], [-1076, 488, 1], [-1074, 488, 1], [-1072, 488, 1], [-1070, 488, 1], [-1068, 488, 1], [-1068, 486, 1], [-1066, 486, 1], [-1064, 486, 1], [-1062, 486, 1], [-1060, 486, 1], [-1058, 486, 1], [-1056, 486, 1], [-1054, 486, 1], [-1052, 486, 1], [-1050, 486, 1], [-1048, 486, 1], [-1046, 486, 1], [-1044, 486, 1], [-1044, 484, 1], [-1042, 484, 1], [-1040, 484, 1], [-1038, 484, 1], [-1036, 484, 1], [-1034, 484, 1], [-1032, 484, 1], [-1030, 484, 1], [-1028, 484, 1], [-1026, 484, 1], [-1024, 484, 1], [-1022, 484, 1], [-1020, 484, 1], [-1018, 484, 1], [-1016, 484, 1], [-1014, 484, 1], [-1012, 484, 1], [-1010, 484, 1], [-1008, 484, 1], [-1006, 484, 1], [-1004, 484, 1], [-1002, 484, 1], [-1000, 484, 1], [-998, 484, 1], [-996, 484, 1], [-994, 484, 1], [-992, 484, 1], [-990, 484, 1], [-988, 484, 1], [-986, 484, 1], [-984, 484, 1], [-982, 484, 1], [-980, 484, 1], [-978, 484, 1], [-976, 484, 1], [-974, 484, 1], [-972, 484, 1], [-970, 484, 1], [-968, 484, 1], [-966, 484, 1], [-964, 484, 1], [-962, 484, 1], [-960, 484, 1], [-958, 484, 1], [-956, 484, 1], [-954, 484, 1], [-952, 484, 1], [-950, 484, 1], [-948, 484, 1], [-946, 484, 1], [-944, 484, 1], [-942, 484, 1], [-940, 484, 1], [-938, 484, 1], [-936, 484, 1], [-934, 484, 1], [-932, 484, 1], [-930, 484, 1], [-928, 484, 1], [-926, 484, 1], [-924, 484, 1], [-922, 484, 1], [-920, 484, 1], [-918, 484, 1], [-916, 484, 1], [-914, 484, 1], [-912, 484, 1], [-910, 484, 1], [-908, 484, 1], [-906, 484, 1], [-904, 484, 1], [-902, 484, 1], [-900, 484, 1], [-898, 484, 1], [-896, 484, 1], [-894, 484, 1], [-892, 484, 1], [-890, 484, 1], [-888, 484, 1], [-886, 484, 1], [-884, 484, 1], [-882, 484, 1], [-880, 484, 1], [-878, 484, 1], [-876, 484, 1], [-874, 484, 1], [-872, 484, 1], [-870, 484, 1], [-868, 484, 1], [-868, 482, 1], [-866, 482, 1], [-864, 482, 1], [-862, 482, 1], [-860, 482, 1], [-858, 482, 1], [-856, 482, 1], [-854, 482, 1], [-852, 482, 1], [-850, 482, 1], [-848, 482, 1], [-846, 482, 1], [-844, 482, 1], [-842, 482, 1], [-840, 482, 1], [-838, 482, 1], [-836, 482, 1], [-834, 482, 1], [-832, 482, 1], [-830, 482, 1], [-828, 482, 1], [-826, 482, 1], [-824, 482, 1], [-822, 482, 1], [-820, 482, 1], [-818, 482, 1], [-816, 482, 1], [-814, 482, 1], [-812, 482, 1], [-810, 482, 1], [-808, 482, 1], [-806, 482, 1], [-804, 482, 1], [-802, 482, 1], [-800, 482, 1], [-798, 482, 1], [-796, 482, 1], [-794, 482, 1], [-792, 482, 1], [-790, 482, 1], [-788, 482, 1], [-786, 482, 1], [-784, 482, 1], [-782, 482, 1], [-780, 482, 1], [-778, 482, 1], [-776, 482, 1], [-774, 482, 1], [-772, 482, 1], [-770, 482, 1], [-768, 482, 1], [-766, 482, 1], [-764, 482, 1], [-762, 482, 1], [-760, 482, 1], [-758, 482, 1], [-756, 482, 1], [-754, 482, 1], [-752, 482, 1], [-750, 482, 1], [-748, 482, 1], [-746, 482, 1], [-744, 482, 1], [-742, 482, 1], [-740, 482, 1], [-738, 482, 1], [-736, 482, 1], [-734, 482, 1], [-732, 482, 1], [-730, 482, 1], [-728, 482, 1], [-726, 482, 1], [-724, 482, 1], [-722, 482, 1], [-720, 482, 1], [-718, 482, 1], [-716, 482, 1], [-716, 480, 1], [-714, 480, 1], [-714, 478, 1], [-714, 476, 1], [-714, 474, 1], [-714, 472, 1], [-714, 470, 1], [-714, 468, 1], [-714, 466, 1], [-714, 464, 1], [-714, 462, 1], [-714, 460, 1], [-714, 458, 1], [-714, 456, 1], [-714, 454, 1], [-714, 452, 1], [-714, 450, 1], [-714, 448, 1], [-714, 446, 1], [-714, 444, 1], [-714, 442, 1], [-714, 440, 1], [-714, 438, 1], [-714, 436, 1], [-714, 434, 1], [-714, 432, 1], [-714, 430, 1], [-714, 428, 1], [-714, 426, 1], [-714, 424, 1], [-714, 422, 1], [-714, 420, 1], [-714, 418, 1], [-714, 416, 1], [-714, 414, 1], [-714, 412, 1], [-714, 410, 1], [-714, 408, 1], [-714, 406, 1], [-714, 404, 1], [-714, 402, 1], [-714, 400, 1], [-714, 398, 1], [-714, 396, 1], [-714, 394, 1], [-714, 392, 1], [-714, 390, 1], [-714, 388, 2], [-714, 386, 2], [-712, 386, 2], [-710, 386, 2], [-708, 386, 2], [-706, 386, 2], [-704, 386, 2], [-702, 386, 2], [-700, 386, 2], [-698, 386, 2], [-696, 386, 2], [-694, 386, 2], [-692, 386, 2], [-690, 386, 2], [-688, 386, 2], [-686, 386, 2], [-684, 386, 2], [-682, 386, 2], [-680, 386, 2], [-678, 386, 2], [-676, 386, 2], [-674, 386, 2], [-672, 386, 2], [-670, 386, 2], [-668, 386, 2], [-666, 386, 2], [-664, 386, 2], [-662, 386, 2], [-660, 386, 2], [-658, 386, 2], [-656, 386, 2], [-654, 386, 2], [-652, 386, 2], [-650, 386, 2], [-648, 386, 2], [-646, 386, 2], [-644, 386, 2], [-642, 386, 2], [-640, 386, 2], [-640, 384, 2], [-638, 384, 2], [-638, 382, 2], [-638, 380, 2], [-638, 378, 2], [-638, 376, 2], [-638, 374, 2], [-638, 372, 2], [-638, 370, 2], [-638, 368, 2], [-638, 366, 2], [-638, 364, 2], [-638, 362, 2], [-638, 360, 2], [-638, 358, 2], [-638, 356, 2], [-638, 354, 2], [-638, 352, 2], [-638, 350, 2], [-638, 348, 2], [-638, 346, 2], [-638, 344, 2], [-638, 342, 2], [-638, 340, 2], [-638, 338, 2], [-638, 336, 2], [-638, 334, 2], [-636, 334, 2], [-634, 334, 2], [-632, 334, 2], [-632, 332, 2], [-632, 330, 2], [-632, 328, 2], [-632, 326, 2], [-632, 324, 2], [-632, 322, 2], [-632, 320, 2], [-632, 318, 2], [-632, 316, 2], [-632, 314, 2], [-632, 312, 2], [-632, 310, 2], [-632, 308, 2], [-632, 306, 2], [-632, 304, 2], [-632, 302, 2], [-632, 300, 2], [-632, 298, 2], [-632, 296, 2], [-632, 294, 2], [-632, 292, 2], [-632, 290, 2], [-632, 288, 2], [-632, 286, 2], [-632, 284, 2], [-632, 282, 2], [-632, 280, 2], [-632, 278, 2], [-632, 276, 2], [-632, 274, 2], [-632, 272, 2], [-632, 270, 2], [-632, 268, 2], [-632, 266, 2], [-632, 264, 2], [-632, 262, 2], [-632, 260, 2], [-632, 258, 2], [-632, 256, 2], [-632, 254, 2], [-632, 252, 2], [-630, 252, 2], [-628, 252, 2], [-626, 252, 2], [-624, 252, 2], [-622, 252, 2], [-620, 252, 2], [-618, 252, 2], [-616, 252, 2], [-614, 252, 2], [-612, 252, 2], [-610, 252, 2], [-610, 250, 2], [-610, 248, 2], [-610, 246, 2], [-608, 246, 2], [-606, 246, 2], [-604, 246, 2], [-602, 246, 2], [-600, 246, 2], [-600, 244, 2], [-598, 244, 2], [-596, 244, 2], [-596, 242, 2], [-594, 242, 2], [-592, 242, 2], [-590, 242, 2], [-588, 242, 2], [-586, 242, 2], [-584, 242, 2], [-584, 240, 2], [-582, 240, 2], [-580, 240, 2], [-578, 240, 2], [-576, 240, 2], [-574, 240, 2], [-572, 240, 2], [-570, 240, 2], [-568, 240, 2], [-568, 238, 2], [-566, 238, 2], [-564, 238, 2], [-562, 238, 2], [-560, 238, 2], [-558, 238, 2], [-556, 238, 2], [-554, 238, 2], [-552, 238, 2], [-550, 238, 2], [-548, 238, 2], [-546, 238, 2], [-544, 238, 2], [-542, 238, 2], [-540, 238, 2], [-538, 238, 2], [-536, 238, 2], [-534, 238, 2], [-532, 238, 2], [-530, 238, 2], [-528, 238, 2], [-526, 238, 2], [-524, 238, 2], [-522, 238, 2], [-520, 238, 2], [-518, 238, 2], [-516, 238, 2], [-514, 238, 2], [-512, 238, 2], [-510, 238, 2], [-508, 238, 2], [-506, 238, 2], [-504, 238, 2], [-502, 238, 2], [-500, 238, 2], [-498, 238, 2], [-496, 238, 2], [-494, 238, 2], [-492, 238, 2], [-490, 238, 2], [-488, 238, 2], [-486, 238, 2], [-484, 238, 2], [-482, 238, 2], [-480, 238, 2], [-478, 238, 2], [-476, 238, 2], [-474, 238, 2], [-472, 238, 2], [-470, 238, 2], [-468, 238, 2], [-466, 238, 2], [-464, 238, 2], [-462, 238, 2], [-460, 238, 2], [-458, 238, 2], [-456, 238, 2], [-456, 236, 2], [-454, 236, 2], [-452, 236, 2], [-450, 236, 2], [-448, 236, 2], [-446, 236, 2], [-444, 236, 2], [-442, 236, 2], [-440, 236, 2], [-438, 236, 2], [-438, 234, 2], [-436, 234, 2], [-434, 234, 2], [-432, 234, 2], [-430, 234, 2], [-428, 234, 2], [-426, 234, 2], [-426, 232, 2], [-424, 232, 2], [-422, 232, 2], [-420, 232, 2], [-418, 232, 2], [-416, 232, 2], [-414, 232, 2], [-412, 232, 2], [-410, 232, 2], [-410, 230, 2], [-408, 230, 2], [-406, 230, 2], [-404, 230, 2], [-402, 230, 2], [-402, 228, 2], [-400, 228, 2], [-398, 228, 2], [-396, 228, 2], [-396, 226, 2], [-394, 226, 2], [-394, 224, 2], [-392, 224, 2], [-390, 224, 2], [-388, 224, 2], [-386, 224, 2], [-384, 224, 2], [-382, 224, 2], [-380, 224, 2], [-378, 224, 2], [-376, 224, 2], [-374, 224, 2], [-372, 224, 2], [-370, 224, 2], [-368, 224, 2], [-366, 224, 2], [-364, 224, 2], [-362, 224, 2], [-360, 224, 2], [-360, 222, 2], [-358, 222, 2], [-356, 222, 2], [-356, 220, 2], [-354, 220, 2], [-352, 220, 2], [-352, 218, 2], [-350, 218, 2], [-350, 216, 2], [-348, 216, 2], [-346, 216, 2], [-346, 214, 2], [-344, 214, 2], [-342, 214, 2], [-342, 212, 2], [-340, 212, 2], [-338, 212, 2], [-336, 212, 2], [-336, 210, 2], [-334, 210, 2], [-332, 210, 2], [-330, 210, 2], [-328, 210, 2], [-328, 208, 2], [-326, 208, 2], [-324, 208, 2], [-324, 206, 2], [-322, 206, 2], [-320, 206, 2], [-318, 206, 2], [-316, 206, 2], [-314, 206, 2], [-314, 204, 2], [-312, 204, 2], [-310, 204, 2], [-308, 204, 2], [-306, 204, 2], [-304, 204, 2], [-302, 204, 2], [-300, 204, 2], [-298, 204, 2], [-298, 202, 2], [-296, 202, 2], [-294, 202, 2], [-292, 202, 2], [-290, 202, 2], [-288, 202, 2], [-286, 202, 2], [-284, 202, 2], [-282, 202, 2], [-280, 202, 2], [-278, 202, 2], [-276, 202, 2], [-274, 202, 2], [-274, 200, 2], [-272, 200, 2], [-270, 200, 2], [-268, 200, 2], [-266, 200, 2], [-264, 200, 2], [-262, 200, 2], [-260, 200, 2], [-258, 200, 2], [-256, 200, 2], [-256, 198, 2], [-254, 198, 2], [-252, 198, 2], [-252, 200, 2], [-252, 202, 2], [-252, 204, 2], [-252, 206, 2], [-252, 208, 2], [-252, 210, 2], [-252, 212, 2], [-250, 212, 2], [-248, 212, 2], [-246, 212, 2], [-244, 212, 2], [-242, 212, 2], [-240, 212, 2], [-238, 212, 2], [-236, 212, 2], [-234, 212, 2], [-232, 212, 2], [-230, 212, 2], [-228, 212, 2], [-226, 212, 2], [-224, 212, 2], [-222, 212, 2], [-220, 212, 2], [-218, 212, 2], [-216, 212, 2], [-214, 212, 2], [-212, 212, 2], [-210, 212, 2], [-208, 212, 2], [-208, 214, 2], [-208, 216, 2], [-208, 218, 2], [-208, 220, 2], [-208, 222, 2], [-208, 224, 2], [-208, 226, 2], [-206, 226, 2], [-204, 226, 2], [-202, 226, 2], [-200, 226, 2], [-198, 226, 2], [-196, 226, 2], [-196, 224, 2], [-196, 222, 2], [-196, 220, 2], [-196, 218, 2], [-194, 218, 2], [-194, 216, 2], [-194, 214, 2], [-194, 212, 2], [-192, 212, 2], [-190, 212, 2], [-188, 212, 2], [-186, 212, 2], [-184, 212, 2], [-182, 212, 2], [-180, 212, 2], [-178, 212, 2], [-176, 212, 2], [-174, 212, 2], [-172, 212, 2], [-170, 212, 2], [-168, 212, 2], [-166, 212, 2], [-164, 212, 2], [-162, 212, 2], [-160, 212, 2], [-158, 212, 2], [-156, 212, 2], [-154, 212, 2], [-152, 212, 2], [-150, 212, 2], [-148, 212, 2], [-146, 212, 2], [-144, 212, 2], [-142, 212, 2], [-140, 212, 2], [-138, 212, 2], [-136, 212, 2], [-134, 212, 2], [-132, 212, 2], [-130, 212, 2], [-128, 212, 2], [-126, 212, 2], [-124, 212, 2], [-122, 212, 2], [-120, 212, 2], [-118, 212, 2], [-116, 212, 2], [-114, 212, 2], [-112, 212, 2], [-110, 212, 2], [-108, 212, 2], [-106, 212, 2], [-104, 212, 2], [-102, 212, 2], [-100, 212, 2], [-98, 212, 2], [-96, 212, 2], [-94, 212, 2], [-92, 212, 2], [-90, 212, 2], [-88, 212, 2], [-86, 212, 2], [-84, 212, 2], [-82, 212, 2], [-80, 212, 2], [-78, 212, 2], [-76, 212, 2], [-74, 212, 2], [-72, 212, 2], [-70, 212, 2], [-68, 212, 2], [-66, 212, 2], [-64, 212, 2], [-62, 212, 2], [-60, 212, 2], [-58, 212, 2], [-56, 212, 2], [-54, 212, 2], [-52, 212, 2], [-50, 212, 2], [-48, 212, 2], [-48, 210, 2], [-48, 208, 2], [-48, 206, 2], [-48, 204, 2], [-48, 202, 2], [-48, 200, 2], [-48, 198, 2], [-48, 196, 2], [-48, 194, 2], [-48, 192, 2], [-48, 190, 2], [-48, 188, 2], [-48, 186, 2], [-48, 184, 2], [-48, 182, 2], [-48, 180, 2], [-48, 178, 2], [-48, 176, 2], [-48, 174, 2], [-48, 172, 2], [-48, 170, 2], [-48, 168, 2], [-48, 166, 2], [-48, 164, 2], [-48, 162, 2], [-48, 160, 2], [-46, 160, 2], [-44, 160, 2], [-42, 160, 2], [-40, 160, 2], [-38, 160, 2], [-36, 160, 2], [-34, 160, 2], [-32, 160, 2], [-30, 160, 2], [-28, 160, 2], [-26, 160, 2], [-24, 160, 2], [-22, 160, 2], [-20, 160, 2], [-18, 160, 2], [-16, 160, 2], [-14, 160, 2], [-14, 158, 2], [-12, 158, 2], [-10, 158, 2], [-10, 156, 2], [-8, 156, 2], [-6, 156, 2], [-4, 156, 2], [-2, 156, 2], [-2, 154, 2], [0, 154, 2], [0, 152, 2], [2, 152, 2], [2, 150, 2], [4, 150, 2], [4, 148, 2], [6, 148, 2], [6, 146, 2], [8, 146, 2], [8, 144, 2], [10, 144, 2], [10, 142, 2], [10, 140, 2], [10, 138, 2], [10, 136, 2], [12, 136, 2], [12, 134, 2], [14, 134, 2], [16, 134, 2], [18, 134, 2], [20, 134, 2], [22, 134, 2], [24, 134, 2], [26, 134, 2], [28, 134, 2], [30, 134, 2], [32, 134, 2], [34, 134, 2], [36, 134, 2], [38, 134, 2], [40, 134, 2], [42, 134, 2], [44, 134, 2], [46, 134, 2], [48, 134, 2], [50, 134, 2], [52, 134, 2], [54, 134, 2], [56, 134, 2], [58, 134, 2], [60, 134, 2], [62, 134, 2], [64, 134, 2], [66, 134, 2], [68, 134, 2], [70, 134, 2], [72, 134, 2], [74, 134, 2], [76, 134, 2], [78, 134, 2], [78, 132, 2], [78, 130, 2], [78, 128, 2], [78, 126, 2], [78, 124, 2], [78, 122, 2], [78, 120, 2], [78, 118, 2], [78, 116, 2], [78, 114, 2], [78, 112, 2], [78, 110, 2], [78, 108, 2], [78, 106, 2], [78, 104, 2], [78, 102, 2], [78, 100, 2], [78, 98, 2], [78, 96, 2], [78, 94, 2], [78, 92, 2], [78, 90, 2], [78, 88, 2], [78, 86, 2], [78, 84, 2], [78, 82, 2], [78, 80, 2], [78, 78, 2], [78, 76, 2], [78, 74, 2], [78, 72, 2], [78, 70, 2], [78, 68, 2], [78, 66, 2], [78, 64, 2], [78, 62, 2], [78, 60, 2], [78, 58, 2], [78, 56, 2], [78, 54, 2], [78, 52, 2], [78, 50, 2], [78, 48, 2], [78, 46, 2], [78, 44, 2], [78, 42, 2], [78, 40, 2], [78, 38, 2], [78, 36, 2], [78, 34, 2], [78, 32, 2], [78, 30, 2], [78, 28, 2], [78, 26, 2], [78, 24, 2], [78, 22, 2], [78, 20, 2], [78, 18, 2], [78, 16, 2], [78, 14, 2], [78, 12, 2], [78, 10, 2], [78, 8, 2], [78, 6, 2], [78, 4, 2], [78, 2, 2], [78, 0, 2], [78, -2, 2], [78, -4, 2], [78, -6, 2], [78, -8, 2], [78, -10, 2], [78, -12, 2], [78, -14, 2], [78, -16, 2], [78, -18, 2], [78, -20, 2], [78, -22, 2], [78, -24, 2], [78, -26, 2], [78, -28, 2], [78, -30, 2], [78, -32, 2], [78, -34, 2], [78, -36, 2], [78, -38, 2], [78, -40, 2], [78, -42, 2], [78, -44, 2], [78, -46, 2], [78, -48, 2], [78, -50, 2], [78, -52, 2], [78, -54, 2], [78, -56, 2], [78, -58, 2], [78, -60, 2], [78, -62, 2], [78, -64, 2], [78, -66, 2], [78, -68, 2], [78, -70, 2], [78, -72, 2], [78, -74, 2], [78, -76, 2], [78, -78, 2], [78, -80, 2], [78, -82, 2], [78, -84, 2], [78, -86, 2], [78, -88, 2], [78, -90, 2], [78, -92, 2], [78, -94, 2], [78, -96, 2], [78, -98, 2], [78, -100, 2], [78, -102, 2], [78, -104, 2], [78, -106, 2], [78, -108, 2], [78, -110, 2], [78, -112, 2], [78, -114, 2], [78, -116, 2], [78, -118, 2], [78, -120, 2], [78, -122, 2], [78, -124, 2], [78, -126, 2], [78, -128, 2], [78, -130, 2], [78, -132, 2], [78, -134, 2], [78, -136, 2], [78, -138, 2], [78, -140, 2], [78, -142, 2], [78, -144, 2], [78, -146, 2], [78, -148, 2], [78, -150, 2], [78, -152, 2], [78, -154, 2], [78, -156, 2], [78, -158, 2], [78, -160, 2], [78, -162, 2], [78, -164, 2], [78, -166, 2], [78, -168, 2], [78, -170, 2], [78, -172, 2], [78, -174, 2], [78, -176, 2], [78, -178, 2], [78, -180, 2], [78, -182, 2], [78, -184, 2], [78, -186, 2], [78, -188, 2], [78, -190, 2], [78, -192, 2], [78, -194, 2], [78, -196, 2], [78, -198, 2], [78, -200, 2], [78, -202, 2], [78, -204, 2], [78, -206, 2], [78, -208, 2], [78, -210, 2], [78, -212, 2], [78, -214, 2], [78, -216, 2], [78, -218, 2], [78, -220, 2], [78, -222, 2], [78, -224, 2], [78, -226, 2], [78, -228, 2], [78, -230, 2], [78, -232, 2], [78, -234, 2], [78, -236, 2], [78, -238, 2], [78, -240, 2], [78, -242, 2], [78, -244, 2], [78, -246, 2], [78, -248, 2], [78, -250, 2], [78, -252, 2], [78, -254, 2], [78, -256, 2], [80, -256, 2], [82, -256, 2], [84, -256, 2], [86, -256, 2], [88, -256, 2], [90, -256, 2], [92, -256, 2], [94, -256, 2], [96, -256, 2], [98, -256, 2], [100, -256, 2], [102, -256, 2], [104, -256, 2], [106, -256, 2], [108, -256, 2], [110, -256, 2], [112, -256, 2], [114, -256, 2], [116, -256, 2], [118, -256, 2], [120, -256, 2], [122, -256, 2], [124, -256, 2], [126, -256, 2], [128, -256, 2], [130, -256, 2], [132, -256, 2], [134, -256, 2], [136, -256, 2], [138, -256, 2], [140, -256, 2], [142, -256, 2], [144, -256, 2], [146, -256, 2], [148, -256, 2], [150, -256, 2], [152, -256, 2], [154, -256, 2], [156, -256, 2], [158, -256, 2], [160, -256, 2], [162, -256, 2], [164, -256, 2], [166, -256, 2], [168, -256, 2], [170, -256, 2], [172, -256, 2], [174, -256, 2], [176, -256, 2], [178, -256, 2], [180, -256, 2], [182, -256, 2], [184, -256, 2], [186, -256, 2], [188, -256, 2], [190, -256, 2], [192, -256, 2], [194, -256, 2], [196, -256, 2], [198, -256, 2], [200, -256, 2], [202, -256, 2], [204, -256, 2], [206, -256, 2], [208, -256, 2], [210, -256, 2], [212, -256, 2], [214, -256, 2], [216, -256, 2], [218, -256, 2], [220, -256, 2], [222, -256, 2], [222, -258, 2], [224, -258, 2], [226, -258, 2], [226, -260, 2], [228, -260, 2], [230, -260, 2], [232, -260, 2], [234, -260, 2], [236, -260, 2], [238, -260, 2], [240, -260, 2], [242, -260, 2], [244, -260, 2], [246, -260, 2], [248, -260, 2], [250, -260, 2], [252, -260, 2], [254, -260, 2], [256, -260, 2], [258, -260, 2], [260, -260, 2], [262, -260, 2], [264, -260, 2], [266, -260, 2], [268, -260, 2], [270, -260, 2], [272, -260, 2], [274, -260, 2], [276, -260, 2], [278, -260, 2], [280, -260, 2], [282, -260, 2], [284, -260, 2], [286, -260, 2], [288, -260, 2], [290, -260, 2], [292, -260, 2], [294, -260, 2], [296, -260, 2], [298, -260, 2], [300, -260, 2], [302, -260, 2], [304, -260, 2], [306, -260, 2], [308, -260, 2], [310, -260, 2], [312, -260, 2], [314, -260, 2], [316, -260, 2], [318, -260, 2], [320, -260, 2], [322, -260, 2], [324, -260, 2], [326, -260, 2], [328, -260, 2], [330, -260, 2], [332, -260, 2], [334, -260, 2], [336, -260, 2], [338, -260, 2], [340, -260, 2], [342, -260, 2], [344, -260, 2], [346, -260, 2], [348, -260, 2], [350, -260, 2], [352, -260, 2], [354, -260, 2], [356, -260, 2], [358, -260, 2], [360, -260, 2], [362, -260, 2], [364, -260, 2], [366, -260, 2], [368, -260, 2], [370, -260, 2], [372, -260, 2], [374, -260, 2], [376, -260, 2], [378, -260, 2], [380, -260, 2], [382, -260, 2], [384, -260, 2], [386, -260, 2], [388, -260, 2], [390, -260, 2], [392, -260, 2], [394, -260, 2], [396, -260, 2], [398, -260, 2], [400, -260, 2], [402, -260, 2], [404, -260, 2], [404, -262, 2], [406, -262, 2], [406, -264, 2], [406, -266, 2], [406, -268, 2], [408, -268, 2], [410, -268, 2], [412, -268, 2], [414, -268, 2], [416, -268, 2], [418, -268, 2], [420, -268, 2], [422, -268, 2], [424, -268, 2], [426, -268, 2], [428, -268, 2], [430, -268, 2], [432, -268, 2], [434, -268, 2], [436, -268, 2], [436, -270, 2], [438, -270, 2], [438, -272, 2], [440, -272, 2], [442, -272, 2], [444, -272, 2], [446, -272, 2], [448, -272, 2], [450, -272, 2], [452, -272, 2], [454, -272, 2], [456, -272, 2], [458, -272, 2], [460, -272, 2], [462, -272, 2], [464, -272, 2], [466, -272, 2], [468, -272, 2], [470, -272, 2], [472, -272, 2], [474, -272, 2], [476, -272, 2], [478, -272, 2], [480, -272, 2], [482, -272, 2], [484, -272, 2], [486, -272, 2], [488, -272, 2], [490, -272, 2], [492, -272, 2], [494, -272, 2], [496, -272, 2], [498, -272, 2], [500, -272, 2], [502, -272, 2], [504, -272, 2], [504, -274, 2], [504, -276, 2], [504, -278, 2], [504, -280, 2], [504, -282, 2], [504, -284, 2], [504, -286, 2], [504, -288, 2], [504, -290, 2], [504, -292, 2], [506, -292, 2], [508, -292, 2], [510, -292, 2], [512, -292, 2], [514, -292, 2], [516, -292, 2], [518, -292, 2], [520, -292, 2], [522, -292, 2], [524, -292, 2], [526, -292, 2], [528, -292, 2], [530, -292, 2], [532, -292, 2], [534, -292, 2], [536, -292, 2], [538, -292, 2], [540, -292, 2], [542, -292, 2], [544, -292, 2], [546, -292, 2], [548, -292, 2], [550, -292, 2], [552, -292, 2], [554, -292, 2], [556, -292, 2], [558, -292, 2], [560, -292, 2], [562, -292, 2], [564, -292, 2], [566, -292, 2], [568, -292, 2], [570, -292, 2], [572, -292, 2], [574, -292, 2], [576, -292, 2], [578, -292, 2], [580, -292, 2], [582, -292, 2], [584, -292, 2], [586, -292, 2], [588, -292, 2], [590, -292, 2], [592, -292, 2], [594, -292, 2], [596, -292, 2], [598, -292, 2], [600, -292, 2], [602, -292, 2], [604, -292, 2], [606, -292, 2], [608, -292, 2], [610, -292, 2], [612, -292, 2], [614, -292, 2], [616, -292, 2], [618, -292, 2], [620, -292, 2], [622, -292, 2], [624, -292, 2], [626, -292, 2], [628, -292, 2], [630, -292, 2], [632, -292, 2], [634, -292, 2], [636, -292, 2], [638, -292, 2], [640, -292, 2], [642, -292, 2], [644, -292, 2], [646, -292, 2], [648, -292, 2], [650, -292, 2], [652, -292, 2], [654, -292, 2], [656, -292, 2], [658, -292, 2], [660, -292, 2], [662, -292, 2], [664, -292, 2], [666, -292, 2], [668, -292, 2], [670, -292, 2], [672, -292, 2], [674, -292, 2], [676, -292, 2], [678, -292, 2], [680, -292, 2], [682, -292, 2], [684, -292, 2], [686, -292, 2], [688, -292, 2]]

const multiplier = 2; // Multiply size of rendered model

var n = 0; // Index of current camera position on path

var lookahead = 15; // How far the camera looks ahead
var headPosition = 20; // How high the camera position is

var mid_x = 652;
var mid_y = 380;

var floorHeight = 50; // Distance between each floor
var textHeight = 40; // Distance from text to respective floor

function addText(text, x, y, group, floor, mid_x, mid_y) {
    /* Function to add room names at certain locations */
    
    var loader = new THREE.FontLoader();
    loader.load('https://threejs.org/examples/fonts/optimer_regular.typeface.json', function(font) {

        var textGeo = new THREE.TextGeometry(text, {
            font: font,
            size: 20,
            height: 1,
        });
        var textMaterial = new THREE.MeshPhongMaterial({
            color: 0x000000,
            visible: true
        });
        var mesh = new THREE.Mesh(textGeo, textMaterial);
        mesh.position.set((x - mid_x) * multiplier, (mid_y - y) * multiplier, floorHeight+floor*textHeight);
        mesh.name = "text1";
        mesh.layers.set(1);
        group.add(mesh);
        
        mesh = new THREE.Mesh(textGeo, textMaterial);
        mesh.position.set((x - mid_x) * multiplier, (mid_y - y) * multiplier, floorHeight+floor*textHeight);
        mesh.name = "text2";
        mesh.layers.set(2);
        group.add(mesh);
    });
};

function createNewPath(newPath) {
    path = newPath;
    
    for(let i = 0; i < pathPoints.length; i++) {
        groups[pathPointsFloors[i]].remove(pathPoints[i]);
    }
    
    pathPoints = [];
    pathPointsFloors = [];
    
    for(let i = 0; i < path.length; i++) {
        var dotGeometry = new THREE.BufferGeometry();
        dotGeometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array([path[i][0], path[i][1], (path[i][2]-1)*floorHeight]), 3));
        var dotMaterial = new THREE.PointsMaterial({ size: 1, color: 0x0000ff });
        var dot = new THREE.Points(dotGeometry, dotMaterial);
        pathPoints.push(dot);
        pathPointsFloors.push(path[i][2]-1);
        groups[path[i][2]-1].add(dot);
    }
    for (let i=0; i<groups.length; i++){
        scene.remove(groups[i])
        scene.add(groups[i])
    }
    changeFloor()
    
    
    n = 0;
    camera_first.position.set(path[0][0], path[0][1], path[0][2]*floorHeight+headPosition);
}

function addLines(points, group, floor) {
    /* Function add walls at certain locations */
    let x1, y1, x2, y2, w;
    x1 = points[0];
    y1 = points[1];
    x2 = points[2];
    y2 = points[3];
    w = points[4] + 1;
    const shape = new THREE.Shape();
    shape.moveTo((x1 - mid_x) * multiplier, (mid_y - y1) * multiplier);
    shape.lineTo((x2 - mid_x) * multiplier, (mid_y - y2) * multiplier);
    shape.lineTo((x2 - mid_x + w) * multiplier, (mid_y - y2) * multiplier);
    shape.lineTo((x1 - mid_x + w) * multiplier, (mid_y - y1) * multiplier);
    shape.lineTo((x1 - mid_x) * multiplier, (mid_y - y1) * multiplier);

    const geometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
    const material = new THREE.MeshPhongMaterial({
        color: 0xffffff
    });
    const mesh = new THREE.Mesh(geometry, material);
    mesh.castShadow = true;
    mesh.receiveShadow = true;
    mesh.position.set(0, 0, floor*floorHeight);
    group.add(mesh);
}

function changeFloor(){
    for (let i=0; i<groups.length; i++){
        groups[i].visible = false
    }
    visibility = floor_btn.value
    groups[floor_btn.value].visible = true
}


function resize() {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight)

    insetwidth = window.innerWidth / 3;
    insetheight = window.innerHeight / 3;
    camera_first.aspect = insetwidth/insetheight;
    camera_first.updateProjectionMatrix();
}

function toggle_navigation() {
    if (travel) {
        travel = false
        pause_text.style.display = "block";
    } else {
        travel = true
        pause_text.style.display = "none";
    }
}

function toggle_panel(){
    console.log(nav.style.width)
    if (nav_panel.style.width == "0px"){
        nav_panel.style.width = "250px";
        main.style.marginLeft = "250px";
        toggle_panel_btn.innerHTML = "<";
        nav_panel.style.visibility = "visible"
    }
    else {
        nav_panel.style.width = "0";
        main.style.marginLeft = "0";
        toggle_panel_btn.innerHTML = ">";
        nav_panel.style.visibility = "hidden"
    }
}

function animate() {
    requestAnimationFrame(animate);
    controls.update();
    scene.traverse (function (object) {
        if (object instanceof THREE.Mesh) {
            if (object.name == "text1") {
                object.quaternion.copy( camera.quaternion );
            }
            if (object.name == "text2") {
                object.quaternion.copy( camera_first.quaternion );
            }
        }
    });
    renderer.setViewport(0, 0, window.innerWidth, window.innerHeight)
    renderer.render(scene, camera);
    renderer.clearDepth();
    renderer.setScissorTest(true);
    renderer.setScissor(
        window.innerWidth - insetwidth - 16,
        window.innerHeight - insetheight - 16,
        insetwidth,
        insetheight,
    );
    renderer.setViewport(
        window.innerWidth - insetwidth - 16,
        window.innerHeight - insetheight - 16,
        insetwidth,
        insetheight,
    );
    renderer.render(scene, camera_first);
    renderer.setScissorTest(false);
    
    // Move first person view camera
    
    if (travel) {
        if (n < path.length) {
            if (path[n][2]-1 != floor_btn.value){
                visibility = path[n][2]-1
                floor_btn.value = path[n][2]-1;
                changeFloor();
                travel = false
            }
            pathPoints[n].material.color.setHex(0xff0000);
        }
        else{
            travel = true
            changeFloor();
        }
        if (n < path.length-lookahead) {
            camera_first.position.set(path[n][0], path[n][1], headPosition+Math.sin(n/6)+(visibility)*floorHeight);
            camera_first.lookAt(path[n + lookahead][0], path[n + lookahead][1], headPosition+Math.sin(n/6)+(visibility)*floorHeight);
        }

        if (n>1){
            if (camera_first.rotation.x>1){
                camera_first.rotation.x = Math.PI / 2;
                camera_first.rotation.z = 0;
            }
            else{
                camera_first.rotation.x = -Math.PI / 2;
                camera_first.rotation.z = Math.PI;
            }
        }
        
        n++;
    }
};

function render_model(model) {
    
    $('#loadingText').html("Rendering model...");
    
    //Get JSON model attributes
    const num_floors = model["num_floors"];
    
    // Setting initial values
    
    visibility = 0;
    size = 20;
    travel = false;
    groups = new Array();
    model_json = model;
    
    // Create Three.js renderer
    
    renderer = new THREE.WebGLRenderer();
    renderer.setPixelRatio(window.devicePixelRatio); //get the correct pixel detail on portable devices
    renderer.domElement.style.position = "absolute";
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(0xefebd9, 1); // Default background color
    
    main = document.createElement("div");
    
    main.appendChild(renderer.domElement);
    document.body.appendChild(main);
    
    nav_panel = document.createElement("div");
    nav_panel.style.width = "250px";
    nav_panel.style.backgroundColor = "#D3D3D3";
    nav_panel.style.position = "absolute";
    nav_panel.style.height = "100%";
    nav_panel.style.top = "0px";
    nav_panel.style.left = "0";
    nav_panel.style.transition = ".4s"
    document.body.appendChild(nav_panel);
    nav_panel.style.visibility = "hidden";
    
    toggle_panel_btn = document.createElement('button');
    toggle_panel_btn.innerHTML = ">";
    toggle_panel_btn.style.position = "absolute";
    toggle_panel_btn.style.top = "0px";
    main.appendChild(toggle_panel_btn);
    toggle_panel_btn.addEventListener("click", toggle_panel)
    
    
    // Create Three.js scene
    
    scene = new THREE.Scene();
    const axesHelper = new THREE.AxesHelper(400);
    scene.add(axesHelper);
    
    // Bird eye view camera
    
    camera = new THREE.PerspectiveCamera(
        90, //FOV
        window.innerWidth / window.innerHeight, //aspect
        1, //near clipping plane
        25000 //far clipping plane
    );
    camera.layers.enable(1);
    camera.position.set(0, 0, 750);
    camera.lookAt(0, 0, 0);
    
    // First person view camera
    
    camera_first = new THREE.PerspectiveCamera(
        90, //FOV
        window.innerWidth / window.innerHeight, //aspect
        1, //near clipping plane
        2500 //far clipping plane
    );
    camera_first.layers.enable(2);
    camera_first.position.set(path[0][0], path[0][1], path[0][2]);
    camera_first.rotation.x = Math.PI / 2;
    camera_first.rotation.z = 0;
    
    const camera_first_helper = new THREE.CameraHelper(camera_first); // Show where first person view camera is
    scene.add(camera_first_helper);
    
    // Create GUI
    
    floor_btn = document.createElement("select");
    floor_btn.setAttribute("id", "currentFloor");
    floor_btn.setAttribute("name", "Floor");
    document.body.appendChild(floor_btn);
    floor_btn.addEventListener("change", changeFloor);
    floor_btn.style.backgroundColor = "white";
    floor_btn.style.position = "absolute";
    
    room1 = document.createElement("input");
    room1.style.position = "absolute";
    room1.style.top = "50px";
    room1.placeholder = "Start...";
    document.body.appendChild(room1);
    room2 = document.createElement("input");
    room2.style.position = "absolute";
    room2.style.top = "150px";
    room2.placeholder = "End...";
    document.body.appendChild(room2);

    findPathButton = document.createElement('button');
    findPathButton.style.position = "absolute";
    findPathButton.style.top = "220px";
    findPathButton.innerHTML = "Find path";
    document.body.appendChild(findPathButton);
    findPathButton.addEventListener("click", findPath);    
    
    pause_text = document.createElement('div');
    pause_node = document.createTextNode("PAUSED");
    pause_text.appendChild(pause_node);
    pause_text.style.position = 'absolute';
    pause_text.style.top = '300px';
    document.body.appendChild(pause_text);

    // Allow camera to be maneuvered
    
    controls = new THREE.TrackballControls(camera, renderer.domElement);
    // controls.rotateSpeed = 0; // Prevent camera rotation 
    
    const color = 0xFFFFFF;
    const intensity = 1.5;
    const light = new THREE.DirectionalLight(color, intensity);
    light.position.set(400, 400, 800);
    light.target.position.set(0, 0, 0);
    light.castShadow = true;
    scene.add(light);
    scene.add(light.target);
    const light_helper = new THREE.DirectionalLightHelper(light, 200);
    scene.add(light_helper);
   
    for (let i = 0; i < num_floors; i++) {
        let list_of_text = model[(i + 1).toString()]["rooms"];
        let list_of_points = model[(i + 1).toString()]["points"];
        group = new THREE.Group();
        var newOption = document.createElement("option");
        newOption.setAttribute("value", i);
        node = document.createTextNode("Floor " + String(i + 1));
        newOption.appendChild(node);
        document.getElementById("currentFloor").appendChild(newOption);
        for (let j = 0; j < list_of_points.length; j++) {
            addLines(list_of_points[j], group, i);
        }
        for (let j = 0; j < list_of_text.length; j++){
            addText(list_of_text[j][0], list_of_text[j][1], list_of_text[j][2], group, i, mid_x, mid_y);
        }
        const plane_geometry = new THREE.PlaneGeometry( mid_x*2*5, mid_y*2*5 );
        const plane_material = new THREE.MeshBasicMaterial( {color: 0xeeeeee, side: THREE.DoubleSide} );
        const plane = new THREE.Mesh( plane_geometry, plane_material );
        plane_geometry.translate(0, 0, i*floorHeight)
        group.add(plane)
        scene.add(group);
        groups.push(group);
        mid_x = 424;
        mid_y = 351;
    }

    pathPoints = [];
    pathPointsFloors= [];
    
    for(let i = 0; i < path.length; i++) {
        var dotGeometry = new THREE.BufferGeometry();
        dotGeometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array([path[i][0], path[i][1], (path[i][2]-1)*floorHeight]), 3));
        var dotMaterial = new THREE.PointsMaterial({ size: 1, color: 0x0000ff });
        var dot = new THREE.Points(dotGeometry, dotMaterial);
        pathPoints.push(dot);
        pathPointsFloors.push(path[i][2]-1);
        groups[path[i][2]-1].add(dot);
    }
    for (let i=0; i<groups.length; i++){
        scene.add(groups[i])
    }
    changeFloor()
    
    resize();
    animate();  
    renderer.domElement.addEventListener("click", toggle_navigation);
    window.addEventListener("resize", resize);
    $('#loadingScreen').remove();
}